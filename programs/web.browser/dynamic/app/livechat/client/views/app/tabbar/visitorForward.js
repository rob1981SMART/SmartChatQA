function module(e,t,n){let s,r,i,a,o,l,c,d,m;n.link("@babel/runtime/helpers/objectSpread2",{default(e){s=e}},0),n.link("meteor/meteor",{Meteor(e){r=e}},0),n.link("meteor/reactive-var",{ReactiveVar(e){i=e}},1),n.link("meteor/kadira:flow-router",{FlowRouter(e){a=e}},2),n.link("meteor/templating",{Template(e){o=e}},3),n.link("toastr",{default(e){l=e}},4),n.link("../../../../../models",{ChatRoom(e){c=e}},5),n.link("../../../../../utils",{t(e){d=e}},6),n.link("./visitorForward.html"),n.link("../../../../../utils/client",{APIClient(e){m=e}},7),o.visitorForward.helpers({visitor:()=>o.instance().visitor.get(),agentName(){return this.name||this.username},onSelectAgents:()=>o.instance().onSelectAgents,agentModifier:()=>(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=e.get();return"@".concat(0===n.length?t:t.replace(new RegExp(e.get()),e=>"<strong>".concat(e,"</strong>")))}),agentConditions(){const e=o.instance().room.get(),{servedBy:{_id:t}={}}=e||{},n=t&&{$ne:t};return{_id:n,status:{$ne:"offline"},statusLivechat:"available"}},selectedAgents:()=>o.instance().selectedAgents.get(),onClickTagAgent:()=>o.instance().onClickTagAgent,departmentModifier:()=>(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=e.get();return"".concat(0===n.length?t:t.replace(new RegExp(e.get(),"i"),e=>"<strong>".concat(e,"</strong>")))}),onClickTagDepartment:()=>o.instance().onClickTagDepartment,selectedDepartments:()=>o.instance().selectedDepartments.get(),onSelectDepartments:()=>o.instance().onSelectDepartments,departmentConditions(){const e=o.instance().departmentForwardRestrictions.get();return s({enabled:!0,numAgents:{$gt:0}},e)}}),o.visitorForward.onCreated((async function(){this.visitor=new i,this.room=new i,this.departments=new i([]),this.selectedAgents=new i([]),this.selectedDepartments=new i([]),this.departmentForwardRestrictions=new i({}),this.onSelectDepartments=e=>{let{item:t}=e;t.text=t.name,this.selectedDepartments.set([t]),this.selectedAgents.set([])},this.onClickTagDepartment=()=>{this.selectedDepartments.set([])},this.onSelectAgents=e=>{let{item:t}=e;this.selectedAgents.set([t]),this.selectedDepartments.set([])},this.onClickTagAgent=e=>{let{username:t}=e;this.selectedAgents.set(this.selectedAgents.get().filter(e=>e.username!==t))},this.autorun(()=>{this.visitor.set(r.users.findOne({_id:o.currentData().visitorId}))}),this.autorun(()=>{this.room.set(c.findOne({_id:o.currentData().roomId}));const{departmentId:e}=this.room.get();e&&r.call("livechat:getDepartmentForwardRestrictions",e,(e,t)=>{this.departmentForwardRestrictions.set(t)})});const{departments:e}=await m.v1.get("livechat/department");this.departments.set(e)})),o.visitorForward.events({"submit form"(e,t){e.preventDefault();const n={roomId:t.room.get()._id,comment:e.target.comment.value},[s]=t.selectedAgents.get();if(s)n.userId=s._id;else if(t.selectedDepartments.get()){const[e]=t.selectedDepartments.get();n.departmentId=e&&e._id}(n.userId||n.departmentId)&&r.call("livechat:transfer",n,(e,t)=>{e?l.error(d(e.error)):t?(this.save(),l.success(d("Transferred")),a.go("/")):l.warning(d("No_available_agents_to_transfer"))})},"click .cancel"(e){e.preventDefault(),this.cancel()}})}

