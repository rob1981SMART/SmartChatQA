function module(e,t,n){let s,i,r,a,o,l,c,u,d,g,p,f,h,S,y,m,v,_,k,b,C,O,J;n.link("@babel/runtime/helpers/objectWithoutProperties",{default(e){s=e}},0),n.link("@babel/runtime/helpers/objectSpread2",{default(e){i=e}},1),n.export({SettingsState:()=>D,useGroup:()=>j,useSection:()=>V,useSettingActions:()=>M,useSettingDisabledState:()=>P,useSectionChangedState:()=>Q,useSetting:()=>A}),n.link("@rocket.chat/fuselage-hooks",{useDebouncedCallback(e){r=e}},0),n.link("meteor/mongo",{Mongo(e){a=e}},1),n.link("meteor/tracker",{Tracker(e){o=e}},2),n.link("react",{default(e){l=e},createContext(e){c=e},useCallback(e){u=e},useContext(e){d=e},useEffect(e){g=e},useLayoutEffect(e){p=e},useMemo(e){f=e},useReducer(e){h=e},useRef(e){S=e},useState(e){y=e}},3),n.link("../../SettingsCachedCollection",{PrivateSettingsCachedCollection(e){m=e}},4),n.link("../../../../../client/contexts/SettingsContext",{useBatchSettingsDispatch(e){v=e}},5),n.link("../../../../../client/contexts/ToastMessagesContext",{useToastMessageDispatch(e){_=e}},6),n.link("../../../../../client/hooks/useEventCallback",{useEventCallback(e){k=e}},7),n.link("../../../../../client/hooks/useReactiveValue",{useReactiveValue(e){b=e}},8),n.link("../../../../../client/contexts/TranslationContext",{useTranslation(e){C=e},useLoadLanguage(e){O=e}},9),n.link("../../../../../client/contexts/UserContext",{useUser(e){J=e}},10);const N=c({});let x;const E=()=>x?[x,Promise.resolve()]:[x=new m,x.init()],T=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e===t||!e&&!t?0:e>t?1:-1},R=(e,t)=>T(e.section,t.section)||T(e.sorter,t.sorter)||T(e.i18nLabel,t.i18nLabel),w=(e,t)=>{let{type:n,payload:s}=t;const{settings:r,persistedSettings:a}=e;switch(n){case"add":return{settings:[...r,...s].sort(R),persistedSettings:[...a,...s].sort(R)};case"change":{const e=e=>e._id!==s._id?e:s;return{settings:r.map(e),persistedSettings:r.map(e)}}case"remove":{const e=e=>e._id!==s;return{settings:r.filter(e),persistedSettings:a.filter(e)}}case"hydrate":{const e={};s.forEach(t=>{e[t._id]=t});const t=t=>e[t._id]?i({},t,{},e[t._id]):t;return{settings:r.map(t),persistedSettings:a}}}return e};function D(e){let{children:t}=e;const[n,i]=y(!0),[r]=y(new Set),o=S({settings:[],persistedSettings:[]}),c=u((e,t)=>{const n=w(e,t);return o.current=n,r.forEach(e=>{e(n)}),n},[w,r]),[,d]=h(c,{settings:[],persistedSettings:[]}),p=S({});g(()=>{const[e,t]=E(),n=()=>{i(!1)};t.then(n,n);const{collection:s}=e,r=new a.Collection(null);p.current={persistedSettingsCollection:s,settingsCollection:r}},[p]),g(()=>{if(n)return;const{current:{persistedSettingsCollection:e,settingsCollection:t}}=p,s=e.find(),i=s.observe({added:e=>t.insert(e),changed:e=>t.update(e._id,e),removed:e=>{let{_id:n}=e;return t.remove(n)}}),r=[];let a;const o=s.observe({added:e=>{r.push(e),clearTimeout(a),a=setTimeout(()=>{d({type:"add",payload:r})},70)},changed:e=>{d({type:"change",payload:e})},removed:e=>{let{_id:t}=e;d({type:"remove",payload:t})}});return()=>{i&&i.stop(),o&&o.stop(),clearTimeout(a)}},[n,p]);const m=S({}),v=u(e=>{let{_id:t}=e,n=s(e,["_id"]);const{current:{settingsCollection:i}}=p,{current:r}=m;clearTimeout(r[t]),r[t]=setTimeout(()=>{i.update(t,{$set:n})},70)},[p,m]),_=u(e=>{e.forEach(v),d({type:"hydrate",payload:e})},[v,d]),k=u(e=>{let{blocked:t,enableQuery:n}=e;if(t)return!0;if(!n)return!1;const{current:{settingsCollection:s}}=p,i=[].concat("string"==typeof n?JSON.parse(n):n);return!i.every(e=>!!s.findOne(e))},[p]),b=f(()=>({subscribers:r,stateRef:o,hydrate:_,isDisabled:k}),[r,o,_,k]);return l.createElement(N.Provider,{children:t,value:b})}const L=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e,t)=>e===t;const{subscribers:n,stateRef:s}=d(N),[i,r]=y(()=>e(s.current)),a=k((e,t,n,s)=>{const i=e(s);t(i,n)||r(i)},e,t,i);return g(()=>(n.add(a),()=>{n.delete(a)}),[a]),p(()=>{a(s.current)}),i},j=e=>{const t=L(t=>t.settings.find(t=>{let{_id:n,type:s}=t;return n===e&&"group"===s})),n=t=>t.filter(t=>{let{group:n}=t;return n===e}),s=L(e=>n(e.settings).some(e=>{let{changed:t}=e;return t})),r=L(e=>Array.from(new Set(n(e.settings).map(e=>{let{section:t}=e;return t||""}))),(e,t)=>e.length===t.length&&e.join()===t.join()),a=v(),{stateRef:o,hydrate:l}=d(N),c=_(),u=C(),g=O(),p=J(),f=k(async(e,t,n,s)=>{let{current:i}=t;const r=e(i.settings),a=r.filter(e=>{let{changed:t}=e;return t}).map(e=>{let{_id:t,value:n,editor:s}=e;return{_id:t,value:n,editor:s}});if(0!==a.length)try{if(await n(a),a.some(e=>{let{_id:t}=e;return"Language"===t})){const e=s.language||a.filter(e=>{let{_id:t}=e;return"Language"===t}).shift().value||"en";try{await g(e),c({type:"success",message:u("Settings_updated",{lng:e})})}catch(o){c({type:"error",message:o})}return}c({type:"success",message:u("Settings_updated")})}catch(o){c({type:"error",message:o})}},n,o,a,p),h=k((e,t,n)=>{let{current:s}=t;const i=e(s.settings),r=e(s.persistedSettings),a=i.filter(e=>{let{changed:t}=e;return t}).map(e=>{const{_id:t,value:n,editor:s}=r.find(t=>{let{_id:n}=t;return n===e._id});return{_id:t,value:n,editor:s,changed:!1}});n(a)},n,o,l);return t&&i({},t,{sections:r,changed:s,save:f,cancel:h})},V=(e,t)=>{t=t||"";const n=n=>n.filter(n=>{let{group:s,section:i}=n;return s===e&&(!t&&!i||t===i)}),s=L(e=>n(e.settings).some(e=>{let{value:t,packageValue:n}=e;return JSON.stringify(t)!==JSON.stringify(n)})),i=L(e=>n(e.settings).map(e=>{let{_id:t}=e;return t}),(e,t)=>e.length===t.length&&e.join()===t.join()),{stateRef:r,hydrate:a,isDisabled:l}=d(N),c=k((e,t,n)=>{let{current:s}=t;const i=e(s.settings).filter(e=>o.nonreactive(()=>!l(e))),r=e(s.persistedSettings),a=i.map(e=>{const{_id:t,value:n,packageValue:s,packageEditor:i}=r.find(t=>{let{_id:n}=t;return n===e._id});return{_id:t,value:s,editor:i,changed:JSON.stringify(s)!==JSON.stringify(n)}});n(a)},n,r,a);return{name:t,canReset:s,settings:i,reset:c}},M=e=>{const{hydrate:t}=d(N),n=r(n=>{let{value:s,editor:r}=n;const a=[i({_id:e._id},void 0!==s&&{value:s},{},void 0!==r&&{editor:r},{changed:JSON.stringify(e.value)!==JSON.stringify(s)||JSON.stringify(r)!==JSON.stringify(e.editor)})];t(a)},100,[t,e]),s=r(()=>{const{_id:n,value:s,packageValue:i,packageEditor:r,editor:a}=e,o=[{_id:n,value:i,editor:r,changed:JSON.stringify(i)!==JSON.stringify(s)||JSON.stringify(r)!==JSON.stringify(a)}];t(o)},100,[t,e]);return{update:n,reset:s}},P=e=>{let{blocked:t,enableQuery:n}=e;const{isDisabled:s}=d(N);return b(()=>s({blocked:t,enableQuery:n}),[t,n])},Q=(e,t)=>L(n=>n.settings.some(n=>{let{group:s,section:i,changed:r}=n;return s===e&&(!t&&!i||t===i)&&r})),A=e=>{const t=t=>t.find(t=>t._id===e),n=L(e=>t(e.settings)),s=L(e=>t(e.persistedSettings)),{update:r,reset:a}=M(s),o=P(s);return i({},n,{disabled:o,update:r,reset:a})}}

