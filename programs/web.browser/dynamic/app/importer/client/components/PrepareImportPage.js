function module(e,t,n){let r,a,l,s,o,i,c,m,u,p,d,h,E,g,_,C,k,I,f,x,S,b,P,y,w,v,T,F,R,D,B,L,M,U;n.link("@babel/runtime/helpers/objectSpread2",{default(e){r=e}},0),n.link("@rocket.chat/fuselage",{Badge(e){a=e},Box(e){l=e},Button(e){s=e},ButtonGroup(e){o=e},CheckBox(e){i=e},Icon(e){c=e},Margins(e){m=e},Table(e){u=e},Tag(e){p=e},Throbber(e){d=e},Pagination(e){h=e},Tabs(e){E=e}},0),n.link("react",{default(e){g=e},useEffect(e){_=e},useState(e){C=e},useMemo(e){k=e},useCallback(e){I=e}},1),n.link("underscore.string",{default(e){f=e}},2),n.link("../../../../client/components/basic/Page",{Page(e){x=e}},3),n.link("../../../../client/contexts/TranslationContext",{useTranslation(e){S=e}},4),n.link("../../../../client/contexts/ToastMessagesContext",{useToastMessageDispatch(e){b=e}},5),n.link("../../lib/ImporterProgressStep",{ProgressStep(e){P=e},ImportWaitingStates(e){y=e},ImportFileReadyStates(e){w=e},ImportPreparingStartedStates(e){v=e},ImportingStartedStates(e){T=e},ImportingErrorStates(e){F=e}},6),n.link("../ImporterWebsocketReceiver",{ImporterWebsocketReceiver(e){R=e}},7),n.link("../functions/showImporterException",{showImporterException(e){D=e}},8),n.link("../../../../client/contexts/RouterContext",{useRoute(e){B=e}},9),n.link("../../../../client/hooks/useSafely",{useSafely(e){L=e}},10),n.link("../../../../client/contexts/ServerContext",{useEndpoint(e){M=e}},11),n.link("../../../ui/client/views/app/components/hooks",{useDebounce(e){U=e}},12);const O=(e,t)=>new Promise((n,r)=>{const a=()=>{e().then(e=>{t(e)?n(e):setTimeout(a,1e3)},r)};a()});function W(e){let{usersCount:t,users:n,setUsers:a}=e;const l=S(),[s,o]=C(0),[c,m]=C(25),d=I(e=>{let{count:t,current:n,itemsPerPage:r}=e;return l("Showing results %s - %s of %s",n+1,Math.min(n+r,t),t)},[]),E=I(()=>l("Items_per_page:"),[]);return g.createElement(g.Fragment,null,g.createElement(u,null,g.createElement(u.Head,null,g.createElement(u.Row,null,g.createElement(u.Cell,{width:"x36"},g.createElement(i,{checked:t>0,indeterminate:t>0&&t!==n.length,onChange:()=>{a(e=>{const n=e.some(e=>{let{is_deleted:t,do_import:n}=e;return t&&n}),a=0===t;return a?e.map(e=>r({},e,{do_import:!0})):n?e.map(e=>e.is_deleted?r({},e,{do_import:!1}):e):e.map(e=>r({},e,{do_import:!1}))})}})),g.createElement(u.Cell,{is:"th"},l("Username")),g.createElement(u.Cell,{is:"th"},l("Email")),g.createElement(u.Cell,{is:"th"}))),g.createElement(u.Body,null,n.slice(s,s+c).map(e=>g.createElement(u.Row,{key:e.user_id},g.createElement(u.Cell,{width:"x36"},g.createElement(i,{checked:e.do_import,onChange:t=>{const{checked:n}=t.currentTarget;a(t=>t.map(t=>t===e?r({},t,{do_import:n}):t))}})),g.createElement(u.Cell,null,e.username),g.createElement(u.Cell,null,e.email),g.createElement(u.Cell,{align:"end"},e.is_deleted&&g.createElement(p,{variant:"danger"},l("Deleted"))))))),g.createElement(h,{current:s,itemsPerPage:c,count:n.length||0,onSetItemsPerPage:m,onSetCurrent:o,itemsPerPageLabel:E,showingResultsLabel:d}))}function j(e){let{channels:t,channelsCount:n,setChannels:a}=e;const l=S(),[s,o]=C(0),[c,m]=C(25),d=I(e=>{let{count:t,current:n,itemsPerPage:r}=e;return l("Showing results %s - %s of %s",n+1,Math.min(n+r,t),t)},[]),E=I(()=>l("Items_per_page:"),[]);return t.length&&g.createElement(g.Fragment,null,g.createElement(u,null,g.createElement(u.Head,null,g.createElement(u.Row,null,g.createElement(u.Cell,{width:"x36"},g.createElement(i,{checked:n>0,indeterminate:n>0&&n!==t.length,onChange:()=>{a(e=>{const t=e.some(e=>{let{is_archived:t,do_import:n}=e;return t&&n}),a=0===n;return a?e.map(e=>r({},e,{do_import:!0})):t?e.map(e=>e.is_archived?r({},e,{do_import:!1}):e):e.map(e=>r({},e,{do_import:!1}))})}})),g.createElement(u.Cell,{is:"th"},l("Name")),g.createElement(u.Cell,{is:"th",align:"end"}))),g.createElement(u.Body,null,t.slice(s,s+c).map(e=>g.createElement(u.Row,{key:e.channel_id},g.createElement(u.Cell,{width:"x36"},g.createElement(i,{checked:e.do_import,onChange:t=>{const{checked:n}=t.currentTarget;a(t=>t.map(t=>t===e?r({},t,{do_import:n}):t))}})),g.createElement(u.Cell,null,e.name),g.createElement(u.Cell,{align:"end"},e.is_archived&&g.createElement(p,{variant:"danger"},l("Importer_Archived"))))))),g.createElement(h,{current:s,itemsPerPage:c,itemsPerPageLabel:E,showingResultsLabel:d,count:t.length||0,onSetItemsPerPage:m,onSetCurrent:o}))}function G(){const e=S(),t=b(),[n,i]=L(C(!0)),[u,p]=L(C(null)),[h,I]=L(C(null)),[G,H]=L(C(0)),[N,A]=C([]),[q,z]=C([]),[J,K]=L(C(!1)),Q=k(()=>N.filter(e=>{let{do_import:t}=e;return t}).length,[N]),V=k(()=>q.filter(e=>{let{do_import:t}=e;return t}).length,[q]),X=B("admin-import"),Y=B("admin-import-new"),Z=B("admin-import-progress"),$=M("GET","getImportFileData"),ee=M("GET","getCurrentImportOperation"),te=M("POST","startImport");_(()=>{const e=e=>{let{rate:t}=e;p(t)};return R.registerCallback(e),()=>{R.unregisterCallback(e)}},[]),_(()=>{const n=async()=>{try{const n=await O($,e=>e&&!e.waiting);if(!n)return t({type:"error",message:e("Importer_not_setup")}),void X.push();if(n.step)return t({type:"error",message:e("Failed_To_Load_Import_Data")}),void X.push();H(n.message_count),A(n.users.map(e=>r({},e,{do_import:!0}))),z(n.channels.map(e=>r({},e,{do_import:!0}))),i(!1),p(null)}catch(n){D(n,"Failed_To_Load_Import_Data"),X.push()}},a=async()=>{try{const{operation:r}=await O(ee,e=>{let{operation:t}=e;return t.valid&&!y.includes(t.status)});if(!r.valid)return void Y.push();if(T.includes(r.status))return void Z.push();if(r.status===P.USER_SELECTION||v.includes(r.status)||w.includes(r.status))return I(r.status),void n();if(F.includes(r.status))return t({type:"error",message:e("Import_Operation_Failed")}),void X.push();if(r.status===P.DONE)return void X.push();t({type:"error",message:e("Unknown_Import_State")}),X.push()}catch(r){t({type:"error",message:e("Failed_To_Load_Import_Data")}),X.push()}};a()},[]);const ne=()=>{X.push()},re=async()=>{K(!0);try{await te({input:{users:N,channels:q}}),Z.push()}catch(e){D(e,"Failed_To_Start_Import"),X.push()}},[ae,le]=C("users"),se=k(()=>e=>()=>le(e),[]),oe=U(h,100);return g.createElement(x,null,g.createElement(x.Header,{title:e("Importing_Data")},g.createElement(o,null,g.createElement(s,{ghost:!0,onClick:ne},g.createElement(c,{name:"back"})," ",e("Back_to_imports")),g.createElement(s,{primary:!0,disabled:J,onClick:re},e("Importer_Prepare_Start_Import")))),g.createElement(x.Content,null,g.createElement(l,{marginInline:"auto",marginBlock:"x24",width:"full",maxWidth:"590px"},g.createElement(l,{is:"h2",textStyle:"p2",textColor:"default"},oe&&e(oe.replace("importer_","importer_status_"))),!n&&g.createElement(E,{flexShrink:0},g.createElement(E.Item,{disabled:0===Q,selected:"users"===ae,onClick:se("users")},e("Users")," ",g.createElement(a,{is:"span"},Q)),g.createElement(E.Item,{selected:"channels"===ae,onClick:se("channels")},e("Channels")," ",g.createElement(a,{is:"span"},V)),g.createElement(E.Item,{disabled:!0},e("Messages"),g.createElement(a,{is:"span"},G))),g.createElement(m,{block:"x24"},n&&g.createElement(g.Fragment,null,u?g.createElement(l,{display:"flex",justifyContent:"center",textStyle:"p1",textColor:"default"},g.createElement(l,{is:"progress",value:(10*u).toFixed(0),max:"1000",marginInlineEnd:"x24"}),g.createElement(l,{is:"span"},f.numberFormat(u,0),"%")):g.createElement(d,{justifyContent:"center"})),!n&&"users"===ae&&g.createElement(W,{usersCount:Q,users:N,setUsers:A}),!n&&"channels"===ae&&g.createElement(j,{channels:q,channelsCount:V,setChannels:z})))))}n.exportDefault(G)}

