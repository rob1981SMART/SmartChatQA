function module(e,t,n){var r,a,u,o,i,c,l,s,m,p,f,d,h,g,E,_,k,b,x,C,v,I,S,w,P,y,T,F,R,D,B,L,M,U,O,W;n.link("@babel/runtime/regenerator",{default:function(e){r=e}},0),n.link("@babel/runtime/helpers/objectSpread2",{default:function(e){a=e}},1),n.link("@babel/runtime/helpers/slicedToArray",{default:function(e){u=e}},2),n.link("@rocket.chat/fuselage",{Badge:function(e){o=e},Box:function(e){i=e},Button:function(e){c=e},ButtonGroup:function(e){l=e},CheckBox:function(e){s=e},Icon:function(e){m=e},Margins:function(e){p=e},Table:function(e){f=e},Tag:function(e){d=e},Throbber:function(e){h=e},Pagination:function(e){g=e},Tabs:function(e){E=e}},0),n.link("react",{default:function(e){_=e},useEffect:function(e){k=e},useState:function(e){b=e},useMemo:function(e){x=e},useCallback:function(e){C=e}},1),n.link("underscore.string",{default:function(e){v=e}},2),n.link("../../../../client/components/basic/Page",{Page:function(e){I=e}},3),n.link("../../../../client/contexts/TranslationContext",{useTranslation:function(e){S=e}},4),n.link("../../../../client/contexts/ToastMessagesContext",{useToastMessageDispatch:function(e){w=e}},5),n.link("../../lib/ImporterProgressStep",{ProgressStep:function(e){P=e},ImportWaitingStates:function(e){y=e},ImportFileReadyStates:function(e){T=e},ImportPreparingStartedStates:function(e){F=e},ImportingStartedStates:function(e){R=e},ImportingErrorStates:function(e){D=e}},6),n.link("../ImporterWebsocketReceiver",{ImporterWebsocketReceiver:function(e){B=e}},7),n.link("../functions/showImporterException",{showImporterException:function(e){L=e}},8),n.link("../../../../client/contexts/RouterContext",{useRoute:function(e){M=e}},9),n.link("../../../../client/hooks/useSafely",{useSafely:function(e){U=e}},10),n.link("../../../../client/contexts/ServerContext",{useEndpoint:function(e){O=e}},11),n.link("../../../ui/client/views/app/components/hooks",{useDebounce:function(e){W=e}},12);var j=function(e,t){return new Promise((function(n,r){var a=function(){e().then((function(e){t(e)?n(e):setTimeout(a,1e3)}),r)};a()}))};function G(e){var t=e.usersCount,n=e.users,r=e.setUsers,o=S(),i=b(0),c=u(i,2),l=c[0],m=c[1],p=b(25),h=u(p,2),E=h[0],k=h[1],x=C((function(e){var t=e.count,n=e.current,r=e.itemsPerPage;return o("Showing results %s - %s of %s",n+1,Math.min(n+r,t),t)}),[]),v=C((function(){return o("Items_per_page:")}),[]);return _.createElement(_.Fragment,null,_.createElement(f,null,_.createElement(f.Head,null,_.createElement(f.Row,null,_.createElement(f.Cell,{width:"x36"},_.createElement(s,{checked:t>0,indeterminate:t>0&&t!==n.length,onChange:function(){r((function(e){var n=e.some((function(e){var t=e.is_deleted,n=e.do_import;return t&&n})),r;return 0===t?e.map((function(e){return a({},e,{do_import:!0})})):n?e.map((function(e){return e.is_deleted?a({},e,{do_import:!1}):e})):e.map((function(e){return a({},e,{do_import:!1})}))}))}})),_.createElement(f.Cell,{is:"th"},o("Username")),_.createElement(f.Cell,{is:"th"},o("Email")),_.createElement(f.Cell,{is:"th"}))),_.createElement(f.Body,null,n.slice(l,l+E).map((function(e){return _.createElement(f.Row,{key:e.user_id},_.createElement(f.Cell,{width:"x36"},_.createElement(s,{checked:e.do_import,onChange:function(t){var n=t.currentTarget.checked;r((function(t){return t.map((function(t){return t===e?a({},t,{do_import:n}):t}))}))}})),_.createElement(f.Cell,null,e.username),_.createElement(f.Cell,null,e.email),_.createElement(f.Cell,{align:"end"},e.is_deleted&&_.createElement(d,{variant:"danger"},o("Deleted"))))})))),_.createElement(g,{current:l,itemsPerPage:E,count:n.length||0,onSetItemsPerPage:k,onSetCurrent:m,itemsPerPageLabel:v,showingResultsLabel:x}))}function H(e){var t=e.channels,n=e.channelsCount,r=e.setChannels,o=S(),i=b(0),c=u(i,2),l=c[0],m=c[1],p=b(25),h=u(p,2),E=h[0],k=h[1],x=C((function(e){var t=e.count,n=e.current,r=e.itemsPerPage;return o("Showing results %s - %s of %s",n+1,Math.min(n+r,t),t)}),[]),v=C((function(){return o("Items_per_page:")}),[]);return t.length&&_.createElement(_.Fragment,null,_.createElement(f,null,_.createElement(f.Head,null,_.createElement(f.Row,null,_.createElement(f.Cell,{width:"x36"},_.createElement(s,{checked:n>0,indeterminate:n>0&&n!==t.length,onChange:function(){r((function(e){var t=e.some((function(e){var t=e.is_archived,n=e.do_import;return t&&n})),r;return 0===n?e.map((function(e){return a({},e,{do_import:!0})})):t?e.map((function(e){return e.is_archived?a({},e,{do_import:!1}):e})):e.map((function(e){return a({},e,{do_import:!1})}))}))}})),_.createElement(f.Cell,{is:"th"},o("Name")),_.createElement(f.Cell,{is:"th",align:"end"}))),_.createElement(f.Body,null,t.slice(l,l+E).map((function(e){return _.createElement(f.Row,{key:e.channel_id},_.createElement(f.Cell,{width:"x36"},_.createElement(s,{checked:e.do_import,onChange:function(t){var n=t.currentTarget.checked;r((function(t){return t.map((function(t){return t===e?a({},t,{do_import:n}):t}))}))}})),_.createElement(f.Cell,null,e.name),_.createElement(f.Cell,{align:"end"},e.is_archived&&_.createElement(d,{variant:"danger"},o("Importer_Archived"))))})))),_.createElement(g,{current:l,itemsPerPage:E,itemsPerPageLabel:v,showingResultsLabel:x,count:t.length||0,onSetItemsPerPage:k,onSetCurrent:m}))}function N(){var e=S(),t=w(),n=U(b(!0)),s=u(n,2),f=s[0],d=s[1],g=U(b(null)),C=u(g,2),N=C[0],A=C[1],q=U(b(null)),z=u(q,2),J=z[0],K=z[1],Q=U(b(0)),V=u(Q,2),X=V[0],Y=V[1],Z=b([]),$=u(Z,2),ee=$[0],te=$[1],ne=b([]),re=u(ne,2),ae=re[0],ue=re[1],oe=U(b(!1)),ie=u(oe,2),ce=ie[0],le=ie[1],se=x((function(){return ee.filter((function(e){var t;return e.do_import})).length}),[ee]),me=x((function(){return ae.filter((function(e){var t;return e.do_import})).length}),[ae]),pe=M("admin-import"),fe=M("admin-import-new"),de=M("admin-import-progress"),he=O("GET","getImportFileData"),ge=O("GET","getCurrentImportOperation"),Ee=O("POST","startImport");k((function(){var e=function(e){var t=e.rate;A(t)};return B.registerCallback(e),function(){B.unregisterCallback(e)}}),[]),k((function(){var n=function(){function n(){var n;return r.async(function(){function u(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,u.next=3,r.awrap(j(he,(function(e){return e&&!e.waiting})));case 3:if(n=u.sent){u.next=8;break}return t({type:"error",message:e("Importer_not_setup")}),pe.push(),u.abrupt("return");case 8:if(!n.step){u.next=12;break}return t({type:"error",message:e("Failed_To_Load_Import_Data")}),pe.push(),u.abrupt("return");case 12:Y(n.message_count),te(n.users.map((function(e){return a({},e,{do_import:!0})}))),ue(n.channels.map((function(e){return a({},e,{do_import:!0})}))),d(!1),A(null),u.next=23;break;case 19:u.prev=19,u.t0=u.catch(0),L(u.t0,"Failed_To_Load_Import_Data"),pe.push();case 23:case"end":return u.stop()}}return u}(),null,null,[[0,19]])}return n}(),u;(function(){function a(){var a,u;return r.async(function(){function o(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,r.awrap(j(ge,(function(e){var t=e.operation;return t.valid&&!y.includes(t.status)})));case 3:if(a=o.sent,(u=a.operation).valid){o.next=8;break}return fe.push(),o.abrupt("return");case 8:if(!R.includes(u.status)){o.next=11;break}return de.push(),o.abrupt("return");case 11:if(u.status!==P.USER_SELECTION&&!F.includes(u.status)&&!T.includes(u.status)){o.next=15;break}return K(u.status),n(),o.abrupt("return");case 15:if(!D.includes(u.status)){o.next=19;break}return t({type:"error",message:e("Import_Operation_Failed")}),pe.push(),o.abrupt("return");case 19:if(u.status!==P.DONE){o.next=22;break}return pe.push(),o.abrupt("return");case 22:t({type:"error",message:e("Unknown_Import_State")}),pe.push(),o.next=30;break;case 26:o.prev=26,o.t0=o.catch(0),t({type:"error",message:e("Failed_To_Load_Import_Data")}),pe.push();case 30:case"end":return o.stop()}}return o}(),null,null,[[0,26]])}return a})()()}),[]);var _e=function(){pe.push()},ke=function(){function e(){return r.async(function(){function e(e){for(;;)switch(e.prev=e.next){case 0:return le(!0),e.prev=1,e.next=4,r.awrap(Ee({input:{users:ee,channels:ae}}));case 4:de.push(),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),L(e.t0,"Failed_To_Start_Import"),pe.push();case 11:case"end":return e.stop()}}return e}(),null,null,[[1,7]])}return e}(),be=b("users"),xe=u(be,2),Ce=xe[0],ve=xe[1],Ie=x((function(){return function(e){return function(){return ve(e)}}}),[]),Se=W(J,100);return _.createElement(I,null,_.createElement(I.Header,{title:e("Importing_Data")},_.createElement(l,null,_.createElement(c,{ghost:!0,onClick:_e},_.createElement(m,{name:"back"})," ",e("Back_to_imports")),_.createElement(c,{primary:!0,disabled:ce,onClick:ke},e("Importer_Prepare_Start_Import")))),_.createElement(I.Content,null,_.createElement(i,{marginInline:"auto",marginBlock:"x24",width:"full",maxWidth:"590px"},_.createElement(i,{is:"h2",textStyle:"p2",textColor:"default"},Se&&e(Se.replace("importer_","importer_status_"))),!f&&_.createElement(E,{flexShrink:0},_.createElement(E.Item,{disabled:0===se,selected:"users"===Ce,onClick:Ie("users")},e("Users")," ",_.createElement(o,{is:"span"},se)),_.createElement(E.Item,{selected:"channels"===Ce,onClick:Ie("channels")},e("Channels")," ",_.createElement(o,{is:"span"},me)),_.createElement(E.Item,{disabled:!0},e("Messages"),_.createElement(o,{is:"span"},X))),_.createElement(p,{block:"x24"},f&&_.createElement(_.Fragment,null,N?_.createElement(i,{display:"flex",justifyContent:"center",textStyle:"p1",textColor:"default"},_.createElement(i,{is:"progress",value:(10*N).toFixed(0),max:"1000",marginInlineEnd:"x24"}),_.createElement(i,{is:"span"},v.numberFormat(N,0),"%")):_.createElement(h,{justifyContent:"center"})),!f&&"users"===Ce&&_.createElement(G,{usersCount:se,users:ee,setUsers:te}),!f&&"channels"===Ce&&_.createElement(H,{channels:ae,channelsCount:me,setChannels:ue})))))}n.exportDefault(N)}

