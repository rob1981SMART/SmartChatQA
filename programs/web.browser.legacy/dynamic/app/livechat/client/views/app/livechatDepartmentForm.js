function module(e,t,n){var a,r,i,s,o,c,l,u,g,f,m,d,h,v,p;n.link("@babel/runtime/regenerator",{default:function(e){a=e}},0),n.link("@babel/runtime/helpers/toConsumableArray",{default:function(e){r=e}},1),n.link("meteor/meteor",{Meteor:function(e){i=e}},0),n.link("meteor/reactive-var",{ReactiveVar:function(e){s=e}},1),n.link("meteor/kadira:flow-router",{FlowRouter:function(e){o=e}},2),n.link("meteor/templating",{Template:function(e){c=e}},3),n.link("underscore",{default:function(e){l=e}},4),n.link("toastr",{default:function(e){u=e}},5),n.link("../../../../ui-utils",{TabBar:function(e){g=e},RocketChatTabBar:function(e){f=e}},6),n.link("../../../../utils",{t:function(e){m=e},handleError:function(e){d=e}},7),n.link("../../../../authorization",{hasPermission:function(e){h=e}},8),n.link("./customTemplates/register",{getCustomFormTemplate:function(e){v=e}},9),n.link("./livechatDepartmentForm.html"),n.link("../../../../utils/client",{APIClient:function(e){p=e}},10),c.livechatDepartmentForm.helpers({department:function(){return c.instance().department.get()},agents:function(){return c.instance().department&&!l.isEmpty(c.instance().department.get())?c.instance().department.get().agents:[]},departmentAgents:function(){return l.sortBy(c.instance().departmentAgents.get(),"username")},showOnRegistration:function(e){var t=c.instance().department.get();return t.showOnRegistration===e||void 0===t.showOnRegistration&&!0===e},showOnOfflineForm:function(e){var t=c.instance().department.get();return t.showOnOfflineForm===e||void 0===t.showOnOfflineForm&&!0===e},requestTagBeforeClosingChat:function(){var e=c.instance().department.get();return!(!e||!e.requestTagBeforeClosingChat)},customFieldsTemplate:function(){return v("livechatDepartmentForm")},data:function(){return{id:o.getParam("_id")}},exceptionsAgents:function(){return l.pluck(c.instance().departmentAgents.get(),"username")},agentModifier:function(){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=e.get();return"@"+(0===n.length?t:t.replace(new RegExp(e.get()),(function(e){return"<strong>"+e+"</strong>"})))}},agentConditions:function(){return{roles:"livechat-agent"}},onSelectAgents:function(){return c.instance().onSelectAgents},selectedAgents:function(){return c.instance().selectedAgents.get()},onClickTagAgents:function(){return c.instance().onClickTagAgents},flexData:function(){return{tabBar:c.instance().tabBar,data:c.instance().tabBarData.get()}},tabBarVisible:function(){return Object.values(g.buttons.get()).some((function(e){return e.groups.some((function(e){return e.startsWith("livechat-department")}))}))},chatClosingTags:function(){return c.instance().chatClosingTags.get()},availableDepartmentTags:function(){return c.instance().availableDepartmentTags.get()},hasAvailableTags:function(){return r(c.instance().availableTags.get()).length>0},hasChatClosingTags:function(){return r(c.instance().chatClosingTags.get()).length>0}}),c.livechatDepartmentForm.events({"submit #department-form":function(e,t){e.preventDefault();var n=t.$("button.save"),a,r=$(e.currentTarget).data("id");if(h("manage-livechat-departments")){var s=t.$("input[name=enabled]:checked").val(),c=t.$("input[name=name]").val(),l=t.$("textarea[name=description]").val(),g=t.$("input[name=showOnRegistration]:checked").val(),f=t.$("input[name=email]").val(),v=t.$("input[name=showOnOfflineForm]:checked").val(),p=t.$("input[name=requestTagBeforeClosingChat]:checked").val(),T=t.chatClosingTags.get();if("1"!==s&&"0"!==s)return u.error(m("Please_select_enabled_yes_or_no"));if(""===c.trim())return u.error(m("Please_fill_a_name"));if(""===f.trim()&&"1"===v)return u.error(m("Please_fill_an_email"));a={enabled:"1"===s,name:c.trim(),description:l.trim(),showOnRegistration:"1"===g,showOnOfflineForm:"1"===v,requestTagBeforeClosingChat:"1"===p,email:f.trim(),chatClosingTags:T}}var b=n.html();n.html(m("Saving")),t.$(".customFormField").each((function(e,n){var r=t.$(n),i=r.attr("name");a[i]=r.val()}));var k=[];t.departmentAgents.get().forEach((function(e){e.count=t.$(".count-"+e.agentId).val(),e.order=t.$(".order-"+e.agentId).val(),k.push(e)}));var A=function(e){if(n.html(b),e)return d(e);u.success(m("Saved")),o.go("livechat-departments")};if(h("manage-livechat-departments"))i.call("livechat:saveDepartment",r,a,k,A);else{if(!h("add-livechat-department-agents"))throw new Error(m("error-not-authorized"));i.call("livechat:saveDepartmentAgents",r,k,A)}},"click .add-agent":function(e,t){var n;e.preventDefault(),t.selectedAgents.get().forEach(function(){function e(e){var n,r,i,s;return a.async(function(){function a(a){for(;;)switch(a.prev=a.next){case 0:if(n=e._id,r=e.username,!(i=t.departmentAgents.get()).find((function(e){var t;return e.agentId===n}))){a.next=4;break}return a.abrupt("return",u.error(m("This_agent_was_already_selected")));case 4:(s=l.clone(e)).agentId=n,delete s._id,i.push(s),t.departmentAgents.set(i),t.selectedAgents.set(t.selectedAgents.get().filter((function(e){return e.username!==r})));case 10:case"end":return a.stop()}}return a}())}return e}())},"click button.back":function(e){e.preventDefault(),o.go("livechat-departments")},"click .remove-agent":function(e,t){var n=this;e.preventDefault(),t.departmentAgents.set(t.departmentAgents.get().filter((function(e){return e.agentId!==n.agentId})))},"click #addTag":function(e,t){e.stopPropagation(),e.preventDefault();var n=r(t.availableTags.get()).length>0,a=n?"#tagSelect":"#tagInput",i=n?"placeholder":"",s=$(a).val(),o=r(t.chatClosingTags.get());""===s||o.indexOf(s)>-1||(o.push(s),t.chatClosingTags.set(o),$(a).val(i))},"click .remove-tag":function(e,t){var n=this;e.stopPropagation(),e.preventDefault();var a=r(t.chatClosingTags.get()).filter((function(e){return e!==n.valueOf()}));t.chatClosingTags.set(a)}}),c.livechatDepartmentForm.onCreated(function(){function e(){var e=this;return a.async(function(){function t(t){for(;;)switch(t.prev=t.next){case 0:this.department=new s({enabled:!0}),this.departmentAgents=new s([]),this.selectedAgents=new s([]),this.tabBar=new f,this.tabBar.showGroup(o.current().route.name),this.tabBarData=new s,this.chatClosingTags=new s([]),this.availableTags=new s([]),this.availableDepartmentTags=new s([]),this.onSelectAgents=function(t){var n=t.item;e.selectedAgents.set([n])},this.onClickTagAgents=function(t){var n=t.username;e.selectedAgents.set(e.selectedAgents.get().filter((function(e){return e.username!==n})))},this.loadAvailableTags=function(t){i.call("livechat:getTagsList",(function(n,a){e.availableTags.set(a||[]);var r,i=e.availableTags.get().filter((function(e){var n=e.departments;return 0===n.length||n.indexOf(t)>-1})).map((function(e){var t;return e.name}));e.availableDepartmentTags.set(i)}))},this.autorun(function(){function t(){var t,n,r,i,s;return a.async(function(){function c(c){for(;;)switch(c.prev=c.next){case 0:if(!(t=o.getParam("_id"))){c.next=12;break}return c.next=4,a.awrap(p.v1.get("livechat/department/"+o.getParam("_id")));case 4:n=c.sent,r=n.department,i=n.agents,s=void 0===i?[]:i,e.department.set(r),e.departmentAgents.set(s),e.chatClosingTags.set(r&&r.chatClosingTags||[]),e.loadAvailableTags(t);case 12:case"end":return c.stop()}}return c}())}return t}());case 13:case"end":return t.stop()}}return t}(),null,this)}return e}())}

